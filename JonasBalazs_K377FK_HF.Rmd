---
title: |-
  Többváltozós statisztikai modellek
  házi feladat
author: "Balázs Jónás"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---


```{r cache, include=FALSE}
cache.enabled <- FALSE
```
```{r dependencies, message=TRUE, warning=FALSE, include=FALSE, cache=cache.enabled}
install.packages('pacman')
library(pacman)
pacman::p_load(ggplot2,
               magrittr, # pipe
               tidyr, # replace_na
               dplyr, # select
               psych, # describe, winsor.mean, winsor.sd
               rcompanion, #groupwiseMean
               MASS, # stepAIC
               mRMRe, # mRMR.data
               readxl # read_excel
               )
```

# TODO

## Adatok frissítése


## outlier, winsorized mean



# Probléma felvetése


Célom a magyar államkötvények első forgalomba hozatalának vizsgálata.

Az első részben bemutatom az adat forrását és ismérveit, valamint az adattisztítás lépéseit. Elsősorban az 5 éves lejárat aukcióinak forgalmi adatait és hozamait fogom vizsgálni.

Meg kell jegyezni, hogy az ismérvek időfüggését figyelmen kívül hagytam és idő helyett nagyobb időszakokat, mint kategóriákat használtam. Mivel a táblázat az összes aukció adatát tartalmazza, nem történt mintavételezés, ezért az intervallumbecslések feltételei automatikusan teljesülnek.


# Adatok forrása és feldolgozása


Forrás: https://akk.hu/statistics/historical-data

Elérés: 2022. nov 21

A táblázat a magyar államkötvények aukciók tartalmazza 1987-től 2021 végéig.


## Adatok jellemzése

### Kötvények alapadatai

|Oszlop neve|Tipusa|Jelentése|
| :---: | :----: |  :---: |
|Type|Nominális|Tranzakció típusa: *ISSUE* (elsődleges kibocsátás), *BUYBACK*(visszavásárlási aukció), *SUBSCRIPTION* (jegyzés), *NON_COMPETETITIVE* (aukciót követő jegyzési mód), *TAP_ISSUE* (rábocsátás), *SWITCH* (csereaukció) |
|Tenor|Ordinális|A kötvény futamidejét jelöli években, hónapokban vagy hetekben. Fontos megjegyezni, hogy ebben az esetben a különbség nem értelmezhető, ezért nem tekinthető intervallum típusnak|
|Security Type|Nominális|A kötvény típusát jelöli|
|Alias|Nominális|A kötvény rövid neve.|
|Date|Intervallum|Az aukció dátuma. A dolgozatban nem vettem figyelembe az ismérvek időbeli alakulását, csak néhány helyen a jelenség megértésénél használtam fel.|
|Settlement|Intervallum|Az elszámolás napja.|
|Maturity Date|Intervallum|A kötvény lejáratának napja.|
|Interest Type|Nominális|Diszkont, fix vagy változó kamatozású kötvény|


### A Kötvények keresletére, hozamára és árára vonatkozó adatok

|Oszlop neve|Tipusa|Jelentése|
| :---: | :----: |  :---: |
|Announced (mln)|Arányskála|Meghirdetett mennyiség névértéke millió forintban|
|Bid Amount (mln)|Arányskála|Benyújtott mennyiség névértéke millió forintban|
|Accepted (mln)|Arányskála|Elfogadott mennyiség névértéke millió forintban|
|Min Yield (%)|Arányskála|Az elfogadott ajánlatok közül a legalacsonyabb hozamú ajánlat|
|Max Yield (%)|Arányskála|Az elfogadott ajánlatok közül a legmagasabb hozamú ajánlat|
|Avg Yield (%)|Arányskála|Az elfogadott ajánlatok mennyiséggel súlyozott átlaga|
|Min Price (%)|Arányskála|Az elfogadott ajánlatok közül a legalacsonyabb árfolyamú a névérték százalékában|
|Max Price (%)|Arányskála|Az elfogadott ajánlatok közül a legmagasabb árfolyamú a névérték százalékában|
|Avg Price (%)|Arányskála|Az elfogadott ajánlatok közül árfolyamainak mennyiséggel súlyozott átlaga a névérték százalékában|

### Számított oszlopok

Hasznosnak tartottam kiemelni a dátumból az évet. Ezt a dataframeben "Year"-nek neveztem, intervallum típusú ismérv.


Az idő helyett 10 éves időszakokat vizsgáltam. Jelenleg diszjunkt időszakok, amelyeken a rendezés értelmezett, ezért tekinthető ordinális típusnak.


Szintén számított oszlop a legkisebb és legnagyobb hozamú ajánlat különbsége, amit YieldSpreadnek neveztem el.


## Megjegyzések

A dolgozatban csak az elsődleges kibocsátások (ISSUE) ismérveit fogom vizsgálni.

A Tenor változóban kötvény tipusától függően különböző jelölést használtak az 1 éves referencia papír esetén: diszkont kincstárjegy esetén "12M", államkötvény esetén az "1Y" jelölést használták. Az adattisztítás során egységes "1Y"-ra cseréltem.
<!-- Példa: -->
<!-- Type	Tenor	Security Type	Alias	Date	Settlement	Interest Type	Announced (mln)	Maturity Date -->
<!-- ISSUE	10Y	KTV	2013/D	2003.05.15	2003.05.22	Fix	30,000.00	2013.02.12 -->
<!-- ISSUE	3Y	KTV	2013/D	2009.05.07	2009.05.13	Fix	5,000.00	2013.02.12 -->

### Egy kötvény életciklusa

| Tenor | Alias | Date | Maturity Date | Hátralévő futamidő |
| :---: | :---: | :---: | :---: | :---: |
| 10Y | 2013/D | 2002.01.10 | 2013.02.12 | 11 év 1 hónap | 
| 3Y | 2013/D | 2009.05.07 | 2013.02.12| 3 év 9 hónap |
| 1Y | 2013/D | 2012.04.18 | 2013.02.12 | 10 hónap |
| 6M | 2013/D | 2012.05.16 | 2013.02.12 | 9 hónap |
| 6M | 2013/D | 2012.09.05 | 2013.02.12 | 5 hónap |
| 3M | 2013/D | 2012.09.19 | 2013.02.12 | 5 hónap |
| 3M | 2013/D | 2012.10.31 | 2013.02.12 | 3 hónap |


Hozamok és árfolyamok csak akkor értelmezhetőek, ha az elfogadott mennyiség pozitív, azaz sikeres volt az aukció. A sikertelen aukciókat a hozamok vizsgálatakor kiszűrtem.

<!-- Fel nem használt ismérvek -->
A "Pro-rata (%)", "Bid pcs", "Accepted pcs" ismérvek pontos definícióját nem találtam meg. Bár az "ISIN" számít az értékpapír azonosítójának, nem lesz szükség rá. A további oszlopok a csereaukciók során felajánlott értékpapírok.


## Szűrések

Csak az elsődleges kibocsátásokat veszem figyelembe.

Nem veszem figyelembe a lakossági állampapírokat, mivel ezek értékesítése nem piaci alapot történik, nem tükrözi a magyar állammal szembeni piaci elvárásokat.

A devizakötvényeket nem érdemes összevetni a forint kötvényekkel a devizaárfolyam valamit az adott devizához tartozó referencia papírnak tekintett állampapírok (pl dollár esetén USA, euró esetén a német állam által kibocsátott kötvények) ismerete nélkül.

Csereaukciók: nem jut új forráshoz az állam, mind a vevő, mind az eladó részéről elsősorban kockázatkezelési célokat szolgál.

Visszavásárlások: Ebben az esetben az állam vevő szerepében jelenik meg, gyakran a lejáratok előtt több részletben vásárolnak vissza kötvényeket

```{r loading.excel, warning=FALSE, include=FALSE, cache=cache.enabled}
## Adatok betöltése és tisztítása ====
auctions <- read_excel("AUCTION_2021_221121191038.xlsx")
auctions <- as.data.frame(auctions)
year <- as.numeric(format(auctions$Date, format="%Y"))

# 10 éves időszakok generálása
periodLength <- 10
periodStarts <- seq(1990, 2030, periodLength)
period <- .bincode(year, periodStarts, right=F)
auctions$Period  <- as.factor(paste(
  periodStarts[period],
  "-", 
  periodStarts[period]+periodLength-1))

# 1 éves lejáratra kétféle jelölést használtak
auctions$Tenor[auctions$Tenor=="12M"]<-"1Y"

# https://akk.hu/statisztika/hozamok-indexek-forgalmi-adatok/referenciahozamok
referenceBonds <- c("3M", "6M",
                    "1Y", "3Y","5Y",
                    "10Y", "15Y", "20Y",
                    "other")
# manuális rendezés:
auctions$Tenor<- factor(auctions$Tenor,
                        levels=referenceBonds)
auctions$Tenor <- auctions$Tenor %>% replace_na(replace = "other")

# Szűrés új kibocsátásokra és fix kamatozási kötvényekre
issues<-auctions[auctions$Type=="ISSUE"
                 & auctions$`Interest Type`!="Float",]
```

```{r bond5.filter, include=FALSE, cache=cache.enabled}
issues$YieldSpread <- issues$`Max Yield (%)` - issues$`Min Yield (%)`
bond5 <- issues[issues$Tenor == "5Y",
                c("Date",
                  "Avg Yield (%)", "Accepted (mln)", # elsődlegesen vizsgált mennyiségek
                  "Announced (mln)", "Bid Amount (mln)",
                  "Min Yield (%)", "Max Yield (%)",
                  "Avg Price (%)", "Min Price (%)","Max Price (%)",
                  "YieldSpread",
                  "Period")]

# Oszlopok nevét egyszerűsítem
colnames(bond5) <- c("Date",
                     "Yield", "Accepted",
                     "Announced", "BidAmount",
                     "MinYield", "MaxYield",
                     "AvgPrice", "MinPrice", "MaxPrice",
                     "YieldSpread", "Period")

# Olvashatóság miatt az elfogadott és meghirdetett mennyiséget millárd forintban használom
bond5$Accepted <- bond5$Accepted/1000
bond5$Announced <- bond5$Announced/1000
bond5$BidAmount <- bond5$BidAmount/1000


# Sikeres kibocsátások:
bond5 <- bond5[bond5$Accepted>0, ]

bond5numeric <- dplyr::select(bond5,-Period, -Date ) # hidden by MASS::select
```

## Bepillantás végeredményként kapott adathalmazba:


```{r glimpse}
head(bond5)
```


# 5 éves kötvények bemutatása


A következőkben a két vizsgált mennyiséget az elfogadott mennyiség és hozamot mutatom be, majd az aukción elért hozamot vizsgálom alaposabban..

Az Államadósságkezelőnek korlátozottan, de van mozgástere az aukciók során. Aukció előtt a finanszírozási igény alapján meghatározzák a meghirdetett mennyiséget és a futamidőt. Az aukció elfogadásakor az mennyiséggel tudja kontrollálni az átlagos hozamot vagy eredménytelennek nyilváníthatja az aukciót. (Két alkalommal fordult elő, hogy a meghirdetett mennyiség kétszeresét fogadta el). Feltehetően az ÁKK már jól ismeri az elsődleges forgalmazókat és ezt is figyelembe tudják venni a meghirdetett mennyiség meghatározásakor.

```{r accPerAnnounce, eval=FALSE, include=FALSE}
issues[((issues$`Accepted (mln)`/issues$`Announced (mln)`)>1.5),]
```


## Hozamok

A hozamok eloszlása bimodális, ami a hisztogramon látszik a legjobban. A hozamban nem jellemzőek a nagy ugrások és outlierekkel sem találkozunk. A describe() függény eredményénél a trimmed érték default értéke 0.1, vagyis a fölső és alső 5%-ot hagyja el az átlagból.

```{r yields}
descYield <- describe(bond5$Yield, quant=c(0.25, 0.5, 0.75))
print(t(descYield), digits = 2)

# print(paste('HuberM:', round(HuberM(bond5$Yield),2)))
print(paste('winsorizált átlag:', round(winsor.mean(bond5$Yield, trim = 0.1),2)))
print(paste('winsorizált szórás:', round(winsor.sd(bond5$Yield, trim = 0.1),2)))

ggplot(data=bond5, aes(x=Yield)) +
  geom_histogram(aes(y=..density..)) +
  geom_density(bw=0.3) +
  labs(title="Average yield of 5-year bonds at issue", # UTF-8 feliratot nem sikerült megoldani
       x="Average yield (%)",
       y= "Relative frequency")

ggplot(data=bond5, aes(x=Yield)) +
  geom_boxplot() +
  coord_flip() +
  labs(title = "Average yield of 5-year bonds at issue",
       x = "Average yield (%)"
       )
  
# 
# ggplot(data=bond5, aes(x=Yield)) +
#   geom_density(bw=0.1) +
#   labs(title="Kernel density becslő (bw=0.1)",
#        x="Átlaghozam (%)",
#        y= "Relatív gyakoriság")
```


## Elfogadott mennyiségek

Mivel csak a sikeres aukciókat vizsgálom, ezért a minimum nem nulla lesz, viszont találunk néhány kiugró értéket. Az eloszlás kissé jobbra elnyúló, normálishoz képest csúcsosabb, nem normális eloszlású.

```{r hist}
descAmount <- describe(bond5$Accepted, quant=c(0.25, 0.5, 0.75))
print(t(descAmount))

ggplot(data=bond5, aes(x=Accepted)) +
  geom_histogram(bins=16)+
  labs(title="Accepted amounts of 5Y bonds",
       x="Accepted amount (bn. HUF)",
       y= "Frequency")


ggplot(data=bond5, aes(x=Accepted)) +
  geom_boxplot() +
  coord_flip() +
  labs(
       x="Accepted amount (bn. HUF)",
       y= "")

print(paste("Outlierek száma: ",
  sum(bond5$Accepted>mean(bond5$Accepted) + 1.5*IQR(bond5$Accepted))))

print("A kiugró értékek dátumai:")
bond5[bond5$Accepted>mean(bond5$Accepted) + 1.5*IQR(bond5$Accepted), "Date"]
```
A dátumokból látszik, hogy a nagyobb kibocsátások 2007-2008-as és 2020-as nehezebb időkben történek.



## Korreláció

Három csoport vehető észre, amik a csoporton belül erős korrelációt mutatnak: hozamok, árfolyamok és mennyiségek.

Ismert, hogy a hozam és árfolyam között determinisztikus kapcsolat van. A véletlen "zaj" abból adódik, hogy a konkrét értékpapír kíválasztása és annak cash-flowja előre nem ismert. A hozamok és árfolyamok között ezért jelentős negatív korreláció van. Amit érdemes megjegyezni, hogy a hozam és a spread közötti pozitív korrelációt.

Nem meglepő a meghirdetett és elfogadott mennyiségek közötti erős korreláció.

Érdemes még felfigyelni az elfogadott mennyiség és hozam közötti gyenge negatív korrelációra. Az aukció során az ÁKK a legkisebb hozamútól kezdve sorban fogadja el az egyre nagyobb hozamú (kisebb árfolyamú) ajánlatokat a stratégiája által meghatározott mértékig. Általában a meghirdetett mennyiségig, kedvező napon, akár annak kétszeresét is elfgoadhatja.



```{r corr, cache=cache.enabled}
print(cor(bond5numeric), digits = 1)
corPlot(bond5numeric, FALSE)

cor.test(bond5numeric$Yield, bond5numeric$Accepted)
```

## Átlaghozam vs elfogadott mennyiség


Az Államadósság kezelő által befolyásolható mennyiség hozam és az elfogadott mennyiség. Mint korábban láttuk a kettő között gyenge negatív korreláció van.
<!-- Ideális esetben miután 11 óra körül beérkeztek az ajánlatok, a legmagasabb árfolyamtól kezdve fogadja el az ajánlatokat a stratégiája által meghatározott mértékig, amivel az átlagos árfolyam csökken, az átlagos hozam pedig nő. -->

```{r y.vs.acc}
ggplot(bond5, aes(Yield, Accepted)) +
  geom_point() +
  geom_density2d() +
  geom_density2d_filled(alpha=0.5)
```

## kmeans

A pontok 3 csoportba tömörülnek. Ezt a három csoportot knn módszerrel próbálom szétválasztani, majd összevetem egy eddig nem használt változóval, az időszakkal.

A 2000 évekre a magas hozamok voltak jellemzőek, a 2010-es években megjeltek az alacsonyabb hozamok. A 2020-as éveknek csak az elején vagyunk, ezért nem hasonlítanám a másik kettőhöz. A legalsó grafikonon látszik, hogy a 2008-9-es válság után láthatóan megváltozott az ÁKK stratégiája. Nagyobb kibocsátások helyett a jobban kontrollálható és kisebb kockázatot jelentő módon gyakrabban, de kisebb összegeket hirdet meg.

```{r kmeans}
k <- kmeans(scale(bond5numeric), centers=3)
kmeans_plot <- bond5numeric
kmeans_plot$cluster <- as.factor(k$cluster)

ggplot(kmeans_plot, aes(x=Yield, y=Accepted)) +
  geom_point(aes(colour=factor(cluster)))


kmeans_plot$Period <- bond5$Period
ggplot(data = kmeans_plot, aes(x=Period)) +
  geom_bar(aes(fill=cluster), position = 'fill') +
  scale_fill_brewer(palette="Dark2")
  
  

# pc <- prcomp(t(scale(bond5numeric)))
# pc <- cbind(pc$rotation[,1], pc$rotation[,2], kmeans_plot$kmeans)
# pc.df <- data.frame(pc$rotation[,1], pc$rotation[,2], kmeans_plot$kmeans)
# 
# plot(pc.df[,1], pc.df[,2], col=pc.df[,3])
# plot(pc[,1], pc[,2], col=pc[,3])
# ggplot(data.frame(pc$rotation), aes(x=PC1, y=PC3)) +
#   geom_point()
ggplot(bond5, aes(x=Date, y=Accepted)) +
  geom_point() +
  labs(title = "Issued ammounts during time")

```
## PCA

### TODO megfelelő mérték

### LASSO és hasonlók



## Lineáris regresszió

### TODO multikollenaritás ellenőrzése, 

### változószelekció --> X mátrix rangja!!!

magas R^2>0.9 tautológia gyanús

Tudjuk, hogy változók között erős korrelációk vannak, ezért a mRMR és forward módszerrel próbálom kiválasztani a szükségeseket. Jelen esetben a forward módszer módszer ad jobb eredményt, amit a két AIC érték viszonyából látunk.

```{r condi}
X <- as.matrix(dplyr::select(bond5numeric,-Yield))
qr(t(A)%*%A)$rank == min(dim(t(A)%*%A))

lambda <- eigen(t(X) %*% X)$values
print(paste('Condition number:', max(lambda) / min(lambda))) # -> meg sem próbálom invertálni

```
```{r select.fwd}


lm.min <- lm(Yield ~ 1, data=bond5numeric)
print(lm.min)
AIC(lm.min)
lm.fwd <- stepAIC(lm.min,
                  direction = "forward",
                  trace = TRUE,
                  scope=list(lower=lm.min,
                             upper=~ Accepted + Announced + BidAmount +
                               AvgPrice +MinPrice+MaxPrice +
                               MinYield + MaxYield +
                               YieldSpread))
summary(lm.fwd)

```

```{R select.mrmr}
bond5mrmr <- mRMR.data(bond5numeric)
x<-solutions(mRMR.classic(data = bond5mrmr,
                          target_indices = c(1),
                          feature_count = 5))
colnames(bond5numeric)[x[[1]]]

lm.mrmr <- lm(Yield ~ MaxYield + MinYield + YieldSpread + MaxPrice + Accepted,
              data=bond5numeric)
summary(lm.mrmr)

AIC(lm.fwd)
AIC(lm.mrmr)
```



# TODO: Kilógó értékek, Winsorizált átlag, HuberM

#  TODO  ###################x
\newpage
##########
\newpage

```{r}

# install.packages("questionr") # Cramer
# install.packages("lawstat") # levene.test

```


\newpage
------------------------------
\newpage
#################
\newpage
# Probléma felvetése

Célom a magyar államkötvények első forgalomba hozatalának vizsgálata. 

Az első részben bemutatom az adat forrását és ismérveit. A második részben az 5 éves lejárat aukcióinak forgalmi adatait és az különböző lejáratok gyakoriságát vizsgáltam. A harmadik részben másik változót, a kötvény kibocsátáskori hozamát vizsgáltam, valamint ennek változását az elmúlt évtizedekben. Az 5 éves lejárat aukcióinak forgalmi és hozam adatait vizsgáltam. A negyedik részben két egymintás hipotézis vizsgálatot mutatok be. Az ötödik részben több változó kapcsolatát vizsgáltam. Az első példa két mennyiségi változó (lejárat és időszak). A második az időszak és hozam kapcsolatáról szól, a harmadik pedig a már külön vizsgált hozam és kibocsátott mennyiség viszonyát mutatja be.

# 3. Az 5 éves államkötvények hozamának vizsgálata az időszak függvényében

A hozamok vizsgálatakor csak a sikeres aukciókat érdemes figyelembe venni, amit az elfogadott mennyiség alapján lehet kiszűrni. Az 5 éves kötvény esetén ez megegyezik azzal a feltétellel, hogy az átlaghozam pozitív, de bízzunk benne, hogy egyszer nekünk is sikerül 0%-os hozammal forrást bevonni az 5 éves lejáraton. 
<!-- Jelenleg a német 5 éves hozam -0.4%  -->

```{r message=FALSE, include=FALSE}
bond5successful <- bond5[bond5$AcceptedAmount>0, ]
```
```{r echo=FALSE, message=TRUE}
ggplot(data=remove_missing(bond5successful, na.rm=TRUE, vars="Yield"),
       aes(y=Yield, x=Period)) +
  geom_boxplot() +
  labs(title="5 éves kötvények hozama",
       x="Időszak",
       y="Hozam (%)")
```


## Lejáratok aránya különböző időszakokban



Az alábbi ábrán a kibocsátott kötvények mennyisége látható az idő függvényében. 2009 körül startégiaváltás vehető észre: gyakoribb aukciók során kisebb mennyiségek kibocsátása. Ezzel valószínűleg jobban kontrollálható a kockázat és költség.


```{r echo=FALSE}
ggplot(data=bond5, aes(x=Date, y=Accepted)) +
  geom_point()+
  labs(title = "accepted vs time",
       x="Date",
       y="Accepted (bn.)")
```




# 5. Kétváltozós kapcsoslatvizsgálat

## Időszak és lejárat kapcsolata

```{r echo=TRUE, warning=FALSE}
ggplot(data=subset(issues,issues$`Accepted (mln)`> 0 ), 
       aes(x=Period, fill =Tenor)) +
  geom_bar(position="fill") +
  scale_fill_brewer(palette="Dark2") +
  labs(title="Ratio of tenors",
       x="Ratio (%)",
       y="Period")
```

Az 5 és 10 éves lejáratok aránya emelkedett a három időszak folyamán, míg a 3 hónapos és 1 éves kötvények aránya jelentősen nem változott. Néhány évre bevezetésre került a 20 éves referencia kötvény is.

```{r warning=FALSE}
# cramer.v(table(issues[issues$`Accepted (mln)`>0,c("Period", "Tenor")]))
```

A Cramer-együttható értéke 0.2882, a kapcsolat gyenge.

További kérdés, hogy a "sokaságban", vagyis a későbbi aukciók során is megmarad ez a gyenge kapcsolat, 

``` {r warning=FALSE, echo=TRUE}
chisq.test(table(issues[issues$`Accepted (mln)`>0,c("Period", "Tenor")]))
```
A p-érték lényegében 0-nak tekinthető, ezért semmilyen alfa érték mellett nem tudjuk elvetni H1-et, vagyis a kapcsolat gyenge, de szignifikáns.


## Időszak és hozam kapcsolata

```{r echo=FALSE}
aov(Yield ~ Period, data=bond5[bond5$Accepted>0,])
sprintf("Between: %s", 2143.8)
sprintf("Residuals: %s", 1672.6)
sprintf("H2: %s", 2143.8/ (2143.8 + 1672.6))
```

A variancia-hányados 56.2%, a p-érték lényegében 0, kisebb 1% alfánál is, így H0 elutasítható, így a időszak és hozam kapcsolata erős és szignifikáns.

Feltételek ellenőrzése:
```{r echo=TRUE, warning=FALSE}
ks.test(bond5[bond5$Accepted>0 & bond5$Period=="2000 - 2009",]$Yield, "pnorm")
```
```{r echo=FALSE}
sprintf("2000-2009-es időszak hozamainak szórása: %s",
        sd(bond5[bond5$Accepted>0 & bond5$Period=="2000 - 2009",]$Yield))
sprintf("2010-2019-es időszak hozamainak szórása: %s",
        sd(bond5[bond5$Accepted>0 & bond5$Period=="2010 - 2019",]$Yield))

```
A Kolmogorov-Smirnov-teszt szerint a p-érték lényegében 0, ezért a null-hipotézist el kell vetnünk, vagyis az első időszakban a hozamok nem normális eloszlásúak. Az azonos szórás feltétele is sérül. Ezek miatt a korábban számított p-érték nem megbízható.


## Két mennyiségi változó kapcsolata

Utolsó vizsgálat tárgya a kötvények mennyiségének és hozamának kapcsolata

```{r echo=FALSE}
ggplot(data=bond5, aes(x=Accepted, y=Yield)) +
  geom_point() +
  geom_line()+
  labs("",
       x="Accepted",
       y="Yield")
```
```{r echo=FALSE}
sprintf("A két változó közötti korreláció: %s",
        cor(bond5$Accepted, bond5$Yield))
(reg <- lm(Yield ~ Accepted, bond5))
summary(reg)
```



A korreláció negatív és abszolút értéke kisebb 0.3-nál. A kapcsolat ellentétes, de gyenge. Nagyobb kereslethez magasabb ár tartozik, a kötvény ára és hozama között monoton csökkenő kapcsolat van. A p-érték 0.0004 1%-nál is kisebb, ezért elvetjük, hogy az egyenes meredeksége 0, így a kapcsolat szignifikáns.
